generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "public"]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model audit_log_entries {
  instance_id String?   @db.Uuid
  id          String    @id @db.Uuid
  payload     Json?     @db.Json
  created_at  DateTime? @db.Timestamptz(6)
  ip_address  String    @default("") @db.VarChar(64)

  @@index([instance_id], map: "audit_logs_instance_id_idx")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model flow_state {
  id                     String                @id @db.Uuid
  user_id                String?               @db.Uuid
  auth_code              String
  code_challenge_method  code_challenge_method
  code_challenge         String
  provider_type          String
  provider_access_token  String?
  provider_refresh_token String?
  created_at             DateTime?             @db.Timestamptz(6)
  updated_at             DateTime?             @db.Timestamptz(6)
  authentication_method  String
  auth_code_issued_at    DateTime?             @db.Timestamptz(6)
  saml_relay_states      saml_relay_states[]

  @@index([created_at(sort: Desc)])
  @@index([auth_code], map: "idx_auth_code")
  @@index([user_id, authentication_method], map: "idx_user_id_auth_method")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model identities {
  provider_id     String
  user_id         String    @db.Uuid
  identity_data   Json
  provider        String
  last_sign_in_at DateTime? @db.Timestamptz(6)
  created_at      DateTime? @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)
  email           String?   @default(dbgenerated("lower((identity_data ->> 'email'::text))"))
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  users           user      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider_id, provider], map: "identities_provider_id_provider_unique")
  @@index([email])
  @@index([user_id])
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model instances {
  id              String    @id @db.Uuid
  uuid            String?   @db.Uuid
  raw_base_config String?
  created_at      DateTime? @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)

  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_amr_claims {
  session_id            String   @db.Uuid
  created_at            DateTime @db.Timestamptz(6)
  updated_at            DateTime @db.Timestamptz(6)
  authentication_method String
  id                    String   @id(map: "amr_id_pk") @db.Uuid
  sessions              sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([session_id, authentication_method], map: "mfa_amr_claims_session_id_authentication_method_pkey")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_challenges {
  id                     String      @id @db.Uuid
  factor_id              String      @db.Uuid
  created_at             DateTime    @db.Timestamptz(6)
  verified_at            DateTime?   @db.Timestamptz(6)
  ip_address             String      @db.Inet
  otp_code               String?
  web_authn_session_data Json?
  mfa_factors            mfa_factors @relation(fields: [factor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "mfa_challenges_auth_factor_id_fkey")

  @@index([created_at(sort: Desc)], map: "mfa_challenge_created_at_idx")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_factors {
  id                           String           @id @db.Uuid
  user_id                      String           @db.Uuid
  friendly_name                String?
  factor_type                  factor_type
  status                       factor_status
  created_at                   DateTime         @db.Timestamptz(6)
  updated_at                   DateTime         @db.Timestamptz(6)
  secret                       String?
  phone                        String?
  last_challenged_at           DateTime?        @unique @db.Timestamptz(6)
  web_authn_credential         Json?
  web_authn_aaguid             String?          @db.Uuid
  last_webauthn_challenge_data Json?
  mfa_challenges               mfa_challenges[]
  users                        user             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, phone], map: "unique_phone_factor_per_user")
  @@index([user_id, created_at], map: "factor_id_created_at_idx")
  @@index([user_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_authorizations {
  id                    String                     @id @db.Uuid
  authorization_id      String                     @unique
  client_id             String                     @db.Uuid
  user_id               String?                    @db.Uuid
  redirect_uri          String
  scope                 String
  state                 String?
  resource              String?
  code_challenge        String?
  code_challenge_method code_challenge_method?
  response_type         oauth_response_type        @default(code)
  status                oauth_authorization_status @default(pending)
  authorization_code    String?                    @unique
  created_at            DateTime                   @default(now()) @db.Timestamptz(6)
  expires_at            DateTime                   @default(dbgenerated("(now() + '00:03:00'::interval)")) @db.Timestamptz(6)
  approved_at           DateTime?                  @db.Timestamptz(6)
  oauth_clients         oauth_clients              @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                 user?                      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_clients {
  id                   String                  @id @db.Uuid
  client_secret_hash   String?
  registration_type    oauth_registration_type
  redirect_uris        String
  grant_types          String
  client_name          String?
  client_uri           String?
  logo_uri             String?
  created_at           DateTime                @default(now()) @db.Timestamptz(6)
  updated_at           DateTime                @default(now()) @db.Timestamptz(6)
  deleted_at           DateTime?               @db.Timestamptz(6)
  client_type          oauth_client_type       @default(confidential)
  oauth_authorizations oauth_authorizations[]
  oauth_consents       oauth_consents[]
  sessions             sessions[]

  @@index([deleted_at])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_consents {
  id            String        @id @db.Uuid
  user_id       String        @db.Uuid
  client_id     String        @db.Uuid
  scopes        String
  granted_at    DateTime      @default(now()) @db.Timestamptz(6)
  revoked_at    DateTime?     @db.Timestamptz(6)
  oauth_clients oauth_clients @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         user          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, client_id], map: "oauth_consents_user_client_unique")
  @@index([user_id, granted_at(sort: Desc)], map: "oauth_consents_user_order_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model one_time_tokens {
  id         String              @id @db.Uuid
  user_id    String              @db.Uuid
  token_type one_time_token_type
  token_hash String
  relates_to String
  created_at DateTime            @default(now()) @db.Timestamp(6)
  updated_at DateTime            @default(now()) @db.Timestamp(6)
  users      user                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, token_type])
  @@index([relates_to], map: "one_time_tokens_relates_to_hash_idx", type: Hash)
  @@index([token_hash], map: "one_time_tokens_token_hash_hash_idx", type: Hash)
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model refresh_tokens {
  instance_id String?   @db.Uuid
  id          BigInt    @id @default(autoincrement())
  token       String?   @unique(map: "refresh_tokens_token_unique") @db.VarChar(255)
  user_id     String?   @db.VarChar(255)
  revoked     Boolean?
  created_at  DateTime? @db.Timestamptz(6)
  updated_at  DateTime? @db.Timestamptz(6)
  parent      String?   @db.VarChar(255)
  session_id  String?   @db.Uuid
  sessions    sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([instance_id])
  @@index([instance_id, user_id])
  @@index([parent])
  @@index([session_id, revoked])
  @@index([updated_at(sort: Desc)])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saml_providers {
  id                String        @id @db.Uuid
  sso_provider_id   String        @db.Uuid
  entity_id         String        @unique
  metadata_xml      String
  metadata_url      String?
  attribute_mapping Json?
  created_at        DateTime?     @db.Timestamptz(6)
  updated_at        DateTime?     @db.Timestamptz(6)
  name_id_format    String?
  sso_providers     sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sso_provider_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saml_relay_states {
  id              String        @id @db.Uuid
  sso_provider_id String        @db.Uuid
  request_id      String
  for_email       String?
  redirect_to     String?
  created_at      DateTime?     @db.Timestamptz(6)
  updated_at      DateTime?     @db.Timestamptz(6)
  flow_state_id   String?       @db.Uuid
  flow_state      flow_state?   @relation(fields: [flow_state_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sso_providers   sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)])
  @@index([for_email])
  @@index([sso_provider_id])
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model schema_migrations {
  version String @id @db.VarChar(255)

  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sessions {
  id                     String           @id @db.Uuid
  user_id                String           @db.Uuid
  created_at             DateTime?        @db.Timestamptz(6)
  updated_at             DateTime?        @db.Timestamptz(6)
  factor_id              String?          @db.Uuid
  aal                    aal_level?
  not_after              DateTime?        @db.Timestamptz(6)
  refreshed_at           DateTime?        @db.Timestamp(6)
  user_agent             String?
  ip                     String?          @db.Inet
  tag                    String?
  oauth_client_id        String?          @db.Uuid
  refresh_token_hmac_key String?
  refresh_token_counter  BigInt?
  mfa_amr_claims         mfa_amr_claims[]
  refresh_tokens         refresh_tokens[]
  oauth_clients          oauth_clients?   @relation(fields: [oauth_client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                  user             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([not_after(sort: Desc)])
  @@index([oauth_client_id])
  @@index([user_id])
  @@index([user_id, created_at], map: "user_id_created_at_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model sso_domains {
  id              String        @id @db.Uuid
  sso_provider_id String        @db.Uuid
  domain          String
  created_at      DateTime?     @db.Timestamptz(6)
  updated_at      DateTime?     @db.Timestamptz(6)
  sso_providers   sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sso_provider_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model sso_providers {
  id                String              @id @db.Uuid
  resource_id       String?
  created_at        DateTime?           @db.Timestamptz(6)
  updated_at        DateTime?           @db.Timestamptz(6)
  disabled          Boolean?
  saml_providers    saml_providers[]
  saml_relay_states saml_relay_states[]
  sso_domains       sso_domains[]

  @@index([resource_id], map: "sso_providers_resource_id_pattern_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model user {
  instance_id                      String?                @db.Uuid
  id                               String                 @id @db.Uuid
  aud                              String?                @db.VarChar(255)
  role                             String?                @db.VarChar(255)
  email                            String?                @db.VarChar(255)
  encrypted_password               String?                @db.VarChar(255)
  emailVerifiedAt                  DateTime?              @map("email_confirmed_at") @db.Timestamptz(6)
  invited_at                       DateTime?              @db.Timestamptz(6)
  confirmation_token               String?                @db.VarChar(255)
  confirmation_sent_at             DateTime?              @db.Timestamptz(6)
  recovery_token                   String?                @db.VarChar(255)
  recovery_sent_at                 DateTime?              @db.Timestamptz(6)
  email_change_token_new           String?                @db.VarChar(255)
  email_change                     String?                @db.VarChar(255)
  email_change_sent_at             DateTime?              @db.Timestamptz(6)
  last_sign_in_at                  DateTime?              @db.Timestamptz(6)
  raw_app_meta_data                Json?
  raw_user_meta_data               Json?
  is_super_admin                   Boolean?
  created_at                       DateTime?              @db.Timestamptz(6)
  updated_at                       DateTime?              @db.Timestamptz(6)
  phone                            String?                @unique
  phoneVerifiedAt                  DateTime?              @map("phone_confirmed_at") @db.Timestamptz(6)
  phone_change                     String?                @default("")
  phone_change_token               String?                @default("") @db.VarChar(255)
  phone_change_sent_at             DateTime?              @db.Timestamptz(6)
  confirmed_at                     DateTime?              @default(dbgenerated("LEAST(email_confirmed_at, phone_confirmed_at)")) @db.Timestamptz(6)
  email_change_token_current       String?                @default("") @db.VarChar(255)
  email_change_confirm_status      Int?                   @default(0) @db.SmallInt
  banned_until                     DateTime?              @db.Timestamptz(6)
  reauthentication_token           String?                @default("") @db.VarChar(255)
  reauthentication_sent_at         DateTime?              @db.Timestamptz(6)
  is_sso_user                      Boolean                @default(false)
  deleted_at                       DateTime?              @db.Timestamptz(6)
  is_anonymous                     Boolean                @default(false)
  identities                       identities[]
  mfa_factors                      mfa_factors[]
  oauth_authorizations             oauth_authorizations[]
  oauth_consents                   oauth_consents[]
  one_time_tokens                  one_time_tokens[]
  sessions                         sessions[]
  blocks_blocks_blocked_idTousers  blocks[]               @relation("blocks_blocked_idTousers")
  blocks_blocks_blocker_idTousers  blocks[]               @relation("blocks_blocker_idTousers")
  devices                          devices[]
  photo_assets                     photo_assets[]
  photo_permissions                photo_permissions[]
  profiles_profiles_idTousers      profile?               @relation("profiles_idTousers")
  profiles_profiles_user_idTousers profile?               @relation("profiles_user_idTousers")
  verificationArtifacts            verificationArtifact[]
  verificationSessions             verificationSession[]
  auditLogs                        auditLog[]

  @@index([instance_id])
  @@index([is_anonymous])
  @@map("users")
  @@schema("auth")
}

model admin_audit {
  id         BigInt   @id @default(autoincrement())
  admin_id   String   @db.Uuid
  action     String
  target     String?
  details    Json?
  created_at DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  admins     admins   @relation(fields: [admin_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model admins {
  user_id     String        @id @db.Uuid
  role        String        @default("moderator")
  admin_audit admin_audit[]
  profiles    profile       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model auditLog {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  action    String
  meta      Json?
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId], map: "verification_audit_user_id_idx")
  @@map("verification_audit")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model blocks {
  blocker_id                     String   @db.Uuid
  blocked_id                     String   @db.Uuid
  created_at                     DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  users_blocks_blocked_idTousers user     @relation("blocks_blocked_idTousers", fields: [blocked_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_blocks_blocker_idTousers user     @relation("blocks_blocker_idTousers", fields: [blocker_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([blocker_id, blocked_id])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model devices {
  user_id    String   @db.Uuid
  token      String
  platform   String
  updated_at DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  provider   String?
  project_id String?
  users      user     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, token])
  @@unique([user_id, token], map: "devices_user_token_unique")
  @@index([project_id], map: "idx_devices_project")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model events {
  id         BigInt   @id @default(autoincrement())
  user_id    String   @db.Uuid
  name       String
  props      Json?
  created_at DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles   profile  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model feature_flags {
  key         String   @id
  enabled     Boolean  @default(false)
  rollout_pct Int      @default(100)
  platform    String   @default("all")
  updated_at  DateTime @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model geo_regions {
  id         String                   @id
  name       String
  geom       Unsupported("geography")
  centroid   Unsupported("geography")
  created_at DateTime                 @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)

  @@index([geom], type: Gist)
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model likes {
  liker_id                          String   @db.Uuid
  likee_id                          String   @db.Uuid
  created_at                        DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles_likes_likee_idToprofiles profile  @relation("likes_likee_idToprofiles", fields: [likee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles_likes_liker_idToprofiles profile  @relation("likes_liker_idToprofiles", fields: [liker_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([liker_id, likee_id])
  @@index([likee_id], map: "likes_likee_idx")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model matches {
  id                                String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_a                            String     @db.Uuid
  user_b                            String     @db.Uuid
  created_at                        DateTime   @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles_matches_user_aToprofiles profile    @relation("matches_user_aToprofiles", fields: [user_a], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles_matches_user_bToprofiles profile    @relation("matches_user_bToprofiles", fields: [user_b], references: [id], onDelete: Cascade, onUpdate: NoAction)
  messages                          messages[]

  @@unique([user_a, user_b], map: "matches_pair_unique")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model messages {
  id         BigInt    @id @default(autoincrement())
  match_id   String    @db.Uuid
  sender_id  String    @db.Uuid
  content    String
  created_at DateTime  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  read_at    DateTime? @db.Timestamptz(6)
  matches    matches   @relation(fields: [match_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles   profile   @relation(fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([match_id, created_at(sort: Desc)], map: "messages_match_idx")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model passes {
  passer_id                           String   @db.Uuid
  passee_id                           String   @db.Uuid
  created_at                          DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles_passes_passee_idToprofiles profile  @relation("passes_passee_idToprofiles", fields: [passee_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles_passes_passer_idToprofiles profile  @relation("passes_passer_idToprofiles", fields: [passer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([passer_id, passee_id])
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model photo_assets {
  id                BigInt              @id @default(autoincrement())
  owner_id          String              @db.Uuid
  storage_path      String
  blurred_path      String?
  visibility_mode   String              @default("public")
  created_at        DateTime?           @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  blurred_bucket    String              @default("photos_blurred")
  storage_bucket    String              @default("photos_private")
  users             user                @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  photo_permissions photo_permissions[]

  @@unique([owner_id, storage_path], map: "photo_assets_owner_storage_path_unique")
  @@index([owner_id], map: "idx_photo_assets_owner")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model photo_permissions {
  photo_id     BigInt
  viewer_id    String       @db.Uuid
  expires_at   DateTime?    @db.Timestamptz(6)
  created_at   DateTime?    @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  photo_assets photo_assets @relation(fields: [photo_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users        user         @relation(fields: [viewer_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([photo_id, viewer_id])
  @@schema("public")
}

model profile_embeddings {
  profile_id String                 @id @db.Uuid
  vector     Unsupported("vector")?
  updated_at DateTime               @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles   profile                @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profile {
  id                                         String                    @id @db.Uuid
  created_at                                 DateTime                  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  country                                    String?                   @db.Char(2)
  region_code                                String?
  display_name                               String?
  bio                                        String?
  birthdate                                  DateTime?                 @db.Date
  gender                                     String?
  orientation                                String?
  interests                                  String[]
  photos                                     Json[]
  location                                   Unsupported("geography")?
  updated_at                                 DateTime                  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  last_active_at                             DateTime?                 @db.Timestamptz(6)
  feedback_score                             Decimal?                  @db.Decimal
  verifiedAt                                 DateTime?                 @map("verified_at") @db.Timestamptz(6)
  is_incognito                               Boolean                   @default(false)
  show_distance                              Boolean                   @default(true)
  show_last_seen                             Boolean                   @default(true)
  location_geohash                           String?
  birthday                                   DateTime?                 @db.Date
  userId                                     String                    @unique(map: "profiles_user_id_idx") @map("user_id") @db.Uuid
  intention                                  String?
  is_premium                                 Boolean                   @default(false)
  primary_photo_path                         String?
  verified                                   Boolean?                  @default(false)
  verifiedScore                              Decimal?                  @map("verified_face_score") @db.Decimal
  verifiedMethod                             String?                   @map("verified_method")
  latitude                                   Float?
  longitude                                  Float?
  primary_photo_id                           BigInt?
  admins                                     admins?
  events                                     events[]
  likes_likes_likee_idToprofiles             likes[]                   @relation("likes_likee_idToprofiles")
  likes_likes_liker_idToprofiles             likes[]                   @relation("likes_liker_idToprofiles")
  matches_matches_user_aToprofiles           matches[]                 @relation("matches_user_aToprofiles")
  matches_matches_user_bToprofiles           matches[]                 @relation("matches_user_bToprofiles")
  messages                                   messages[]
  passes_passes_passee_idToprofiles          passes[]                  @relation("passes_passee_idToprofiles")
  passes_passes_passer_idToprofiles          passes[]                  @relation("passes_passer_idToprofiles")
  profile_embeddings                         profile_embeddings?
  users_profiles_idTousers                   user                      @relation("profiles_idTousers", fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_profiles_user_idTousers              user                      @relation("profiles_user_idTousers", fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  push_queue                                 push_queue[]
  reports_reports_reported_user_idToprofiles reports[]                 @relation("reports_reported_user_idToprofiles")
  reports_reports_reporter_idToprofiles      reports[]                 @relation("reports_reporter_idToprofiles")
  search_prefs                               search_prefs?

  @@index([country])
  @@index([location_geohash, updated_at(sort: Desc)], map: "profiles_location_geohash_updated_idx")
  @@index([location], map: "profiles_location_gist_idx", type: Gist)
  @@index([location_geohash, updated_at(sort: Desc)], map: "profiles_location_updated_idx")
  @@index([latitude, longitude], map: "profiles_lat_lng_idx")
  @@index([primary_photo_id])
  @@map("profiles")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model push_queue {
  id           BigInt    @id @default(autoincrement())
  user_id      String    @db.Uuid
  type         String
  payload      Json
  scheduled_at DateTime  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  attempts     Int       @default(0)
  processed_at DateTime? @db.Timestamptz(6)
  created_at   DateTime  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles     profile   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([processed_at, scheduled_at], map: "push_queue_scheduled_idx")
  @@schema("public")
}

model region_sets {
  id            String   @id
  country_codes String[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reports {
  id                                          BigInt   @id @default(autoincrement())
  reporter_id                                 String   @db.Uuid
  reported_user_id                            String   @db.Uuid
  reason                                      String?
  details                                     String?
  created_at                                  DateTime @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles_reports_reported_user_idToprofiles profile  @relation("reports_reported_user_idToprofiles", fields: [reported_user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles_reports_reporter_idToprofiles      profile  @relation("reports_reporter_idToprofiles", fields: [reporter_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([reporter_id, created_at(sort: Desc)], map: "reports_reporter_created_idx")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model search_prefs {
  user_id     String             @id @db.Uuid
  region_mode search_region_mode @default(NEARBY)
  updated_at  DateTime           @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  profiles    profile            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

model verificationSession {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                String                 @map("user_id") @db.Uuid
  status                String                 @default("pending")
  failureReason         String?                @map("failure_reason")
  similarityScore       Float?                 @map("similarity_score")
  livenessScore         Float?                 @map("liveness_score")
  expiresAt             DateTime?              @map("expires_at") @db.Timestamptz(6)
  createdAt             DateTime               @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime               @default(now()) @map("updated_at") @db.Timestamptz(6)
  verificationArtifacts verificationArtifact[]
  user                  user                   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
  @@map("verification_sessions")
  @@schema("public")
}

model verificationArtifact {
  id         String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sessionId  String?              @map("session_id") @db.Uuid
  userId     String?              @map("user_id") @db.Uuid
  type       String
  storageUrl String?              @map("storage_url")
  createdAt  DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  session    verificationSession? @relation(fields: [sessionId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       user?                @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sessionId])
  @@index([userId])
  @@map("verification_artifacts")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)

  @@schema("public")
}

enum aal_level {
  aal1
  aal2
  aal3

  @@schema("auth")
}

enum code_challenge_method {
  s256
  plain

  @@schema("auth")
}

enum factor_status {
  unverified
  verified

  @@schema("auth")
}

enum factor_type {
  totp
  webauthn
  phone

  @@schema("auth")
}

enum oauth_authorization_status {
  pending
  approved
  denied
  expired

  @@schema("auth")
}

enum oauth_client_type {
  public
  confidential

  @@schema("auth")
}

enum oauth_registration_type {
  dynamic
  manual

  @@schema("auth")
}

enum oauth_response_type {
  code

  @@schema("auth")
}

enum one_time_token_type {
  confirmation_token
  reauthentication_token
  recovery_token
  email_change_token_new
  email_change_token_current
  phone_change_token

  @@schema("auth")
}

enum search_region_mode {
  NEARBY
  CHECHNYA
  EUROPE
  RUSSIA

  @@schema("public")
}
